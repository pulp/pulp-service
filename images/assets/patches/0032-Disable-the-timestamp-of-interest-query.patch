From f78af2cc5e233bd871659d5ea6fb219d1248dea2 Mon Sep 17 00:00:00 2001
From: git-hyagi <45576767+git-hyagi@users.noreply.github.com>
Date: Fri, 5 Dec 2025 09:06:15 -0300
Subject: [PATCH] Disable the timestamp of interest query

---
 pulpcore/app/models/content.py | 24 +++---------------------
 1 file changed, 3 insertions(+), 21 deletions(-)

diff --git a/pulpcore/app/models/content.py b/pulpcore/app/models/content.py
index 4a6cf2bc3..8e8aedeb4 100644
--- a/pulpcore/app/models/content.py
+++ b/pulpcore/app/models/content.py
@@ -105,27 +105,9 @@ class BulkTouchQuerySet(models.QuerySet):
 
     def touch(self):
         """
-        Update the ``timestamp_of_interest`` on all objects of the query.
-        """
-
-        # Postgres' UPDATE call doesn't support order-by. This can (and does) result in deadlocks in
-        # high-concurrency environments, when using touch() on overlapping data sets. In order to
-        # prevent this, we choose to SELECT FOR UPDATE with SKIP LOCKS == True, and only update
-        # the rows that we were able to get locks on. Since a previously-locked-row implies
-        # that updating that row's timestamp-of-interest is the responsibility of whoever currently
-        # owns it, this results in correct data, while closing the window on deadlocks.
-        # Django requires "select_for_update" to be used in a transaction even if this is a
-        # singular query.
-        # `no_key` translates to `SELECT ... FOR NO KEY UPDATE` and results in a different type of
-        # lock being used. We don't change any primary/foreign keys.
-        with transaction.atomic():
-            sub_q = (
-                self.filter(timestamp_of_interest__lt=now() - datetime.timedelta(hours=1))
-                .order_by("pk")
-                .select_for_update(skip_locked=True, no_key=True)
-            )
-            self.filter(pk__in=sub_q).update(timestamp_of_interest=now())
-
+        ref: https://issues.redhat.com/browse/PULP-1001
+        """
+        return 1
 
 class QueryMixin:
     """
-- 
2.46.2

